angular.module("ngLocalStorage",[]).factory("$localStorage",["$window","$q",function(e,r){function t(e){try{e=JSON.parse(e)}catch(r){}return e}return{get:function(o,n){var a,c=r.defer();try{e.localStorage.hasOwnProperty(o)?a=t(e.localStorage[o]):(o="string"==typeof o?o.split(","):o,a={},angular.forEach(o,function(r){a[r]=t(e.localStorage[r])})),c.resolve(a)}catch(l){c.reject(l)}return c.promise},set:function(t,o){var n=r.defer(),a=this,c=[];try{"string"==typeof t?(e.localStorage[t]="string"!=typeof o?JSON.stringify(o):o,c.push(t)):null===t||"object"!=typeof t||Array.isArray(t)||angular.forEach(t,function(r,t){e.localStorage[t]="string"!=typeof o?JSON.stringify(r):r,c.push(t)}),a.get(c).then(function(e){n.resolve(e)})}catch(l){n.reject(l)}return n.promise},remove:function(t){var o=r.defer();try{e.localStorage.hasOwnProperty(t)&&e.localStorage.removeItem(t),"string"==typeof t||Array.isArray(t)?(t="string"==typeof t?t.split(","):t,angular.forEach(t,function(r){e.localStorage.removeItem(r)}),o.resolve()):null!==t&&"object"==typeof key?(angular.forEach(t,function(r,t){e.localStorage.removeItem(t)}),o.resolve()):o.reject("Unsupported key type")}catch(n){o.reject(n)}return o.promise},filter:function(e){var t=r.defer(),o=this,n={};e=e instanceof RegExp?e:new RegExp(e,"i");try{o.all().then(function(r){angular.forEach(r,function(r,t){e.test(t)&&(n[t]=r)}),t.resolve(n)})}catch(a){t.reject(a)}return t.promise},map:function(e){var t=r.defer(),o=this,n={};"function"!=typeof e&&t.reject("Not a function");try{o.all().then(function(r){angular.forEach(r,function(r,t){e(r,t)&&(n[t]=r)}),t.resolve(n)})}catch(a){t.reject()}return t.promise},exists:function(t){var o=r.defer();return e.localStorage.hasOwnProperty(t)?o.resolve(t):o.reject(t),o.promise},all:function(){var o=r.defer(),n={};try{angular.forEach(e.localStorage,function(e,r){n[r]=t(e)}),o.resolve(n)}catch(a){o.reject(a)}return o.promise}}}]);