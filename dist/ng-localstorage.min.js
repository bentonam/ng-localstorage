angular.module("ngLocalStorage",[]).factory("$localStorage",["$window","$q",function(r,e){function t(r){try{r=JSON.parse(r)}catch(e){}return r}return{get:function(o,n){var a,c=e.defer();try{r.localStorage.hasOwnProperty(o)?a=t(r.localStorage[o]):(o="string"==typeof o?o.split(","):o,a={},angular.forEach(o,function(e){a[e]=t(r.localStorage[e])})),c.resolve(a)}catch(l){c.reject(l)}return c.promise},set:function(t,o){var n=e.defer(),a=this,c=[];try{"string"==typeof t?(r.localStorage[t]="string"!=typeof o?JSON.stringify(o):o,c.push(t)):null===t||"object"!=typeof t||Array.isArray(t)||angular.forEach(t,function(e,t){r.localStorage[t]="string"!=typeof o?JSON.stringify(e):e,c.push(t)}),a.get(c).then(function(r){n.resolve(r)})}catch(l){n.reject(l)}return n.promise},remove:function(t){var o=e.defer();try{r.localStorage.hasOwnProperty(t)&&r.localStorage.removeItem(t),"string"==typeof t||Array.isArray(t)?(t="string"==typeof t?t.split(","):t,angular.forEach(t,function(e){r.localStorage.removeItem(e)}),o.resolve()):null!==t&&"object"==typeof key?(angular.forEach(t,function(e,t){r.localStorage.removeItem(t)}),o.resolve()):o.reject("Unsupported key type")}catch(n){o.reject(n)}return o.promise},filter:function(r){var t=e.defer(),o=this,n={};r=r instanceof RegExp?r:new RegExp(r,"i");try{o.all().then(function(e){angular.forEach(e,function(e,t){r.test(t)&&(n[t]=e)}),t.resolve(n)})}catch(a){t.reject(a)}return t.promise},map:function(r){var t=e.defer(),o=this,n={};"function"!=typeof r&&t.reject("Not a function");try{o.all().then(function(e){angular.forEach(e,function(e,t){r(e,t)&&(n[t]=e)}),t.resolve(n)})}catch(a){t.reject()}return t.promise},all:function(){var o=e.defer(),n={};try{angular.forEach(r.localStorage,function(r,e){n[e]=t(r)}),o.resolve(n)}catch(a){o.reject(a)}return o.promise}}}]);